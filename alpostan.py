import streamlit as st
import pywhatkit as kit
import random
from datetime import datetime

# --- ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ ุงูุงุญุชุฑุงููุฉ ---
st.set_page_config(
    page_title="AL-POSTAN AI Marketing Suite",
    page_icon="๐",
    layout="wide"
)

# --- ุชูุณูู ุงูุชุตููู (CSS) ---
st.markdown("""
    <style>
    .main { background-color: #f8f9fa; }
    .stButton>button { width: 100%; border-radius: 8px; height: 3em; background-color: #27ae60; color: white; font-weight: bold; }
    .stTabs [data-baseweb="tab-list"] { gap: 20px; }
    .stTabs [data-baseweb="tab"] { background-color: #e9ecef; border-radius: 5px; padding: 10px 20px; }
    </style>
    """, unsafe_allow_html=True)

# --- ุงูุนููุงู ุงูุฑุฆูุณู ---
st.title("๐ก ููุธููุฉ AL-POSTAN ููุชุณููู ุงูุฐูู")
st.markdown("๐๏ธ *ุงูุฃุฏุงุฉ ุงูุดุงููุฉ ูุชุญููู ุงูููุงูุณููุ ุตูุงุนุฉ ุงููุญุชููุ ูุฌุฏููุฉ ุงูููุดูุฑุงุช*")
st.divider()

# --- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ (Sidebar) ---
with st.sidebar:
    st.image("https://cdn-icons-png.flaticon.com/512/1998/1998087.png", width=100)
    st.header("๐ฒ ุชูุงุตู ูุน ุงูุนููู")
    client_phone = st.text_input("ุฑูู ูุงุชุณุงุจ ุงูุนููู (ุจููุชุงุญ ุงูุฏููุฉ)", placeholder="+2010XXXXXXXX")
    st.info("ููุงุญุธุฉ: ุฅุฑุณุงู ุงููุงุชุณุงุจ ูุนูู ุนูุฏ ุชุดุบูู ุงูุจุฑูุงูุฌ ูุญููุงู ููุญุชุงุฌ ูุชุญ WhatsApp Web.")
    st.divider()
    st.write("โ ุฅุตุฏุงุฑ v2.0 - 2026")

# --- ุชุนุฑูู ุงูุชุจููุจุงุช ุงูุฃุฑุจุนุฉ (ุญู ูุดููุฉ NameError) ---
tab1, tab2, tab3, tab4 = st.tabs([
    "๐ ุชุญููู ุงูุณูู", 
    "โ๏ธ ุชูููุฏ ุงููุญุชูู", 
    "๐ผ๏ธ ุงูุชุตููู ุงููุฑุฆู", 
    "๐ ุฌุฏูู ุงูู 30 ูููุงู"
])

# --- ุงูุชุจููุจ ุงูุฃูู: ุชุญููู ุงูุณูู ---
with tab1:
    st.subheader("๐ ูุฏุฎูุงุช ุงูุงุณุชุฑุงุชูุฌูุฉ")
    col1, col2 = st.columns(2)
    with col1:
        prod_name = st.text_input("ุงุณู ุงูููุชุฌ ุฃู ุงูุฎุฏูุฉ", placeholder="ูุซูุงู: ุจุฑูุงูุฌ ูุงุดูุฑ ุงูุจุณุชุงู")
        pain_point = st.text_area("ุฃูู ุงูุนููู (ุงููุดููุฉ ุงูุชู ููุงุฌููุง)", placeholder="ูุซูุงู: ุตุนูุจุฉ ุญุณุงุจ ุงูุฃุฑุจุงุญ ูุถูุงุน ุงูููุงุชูุฑ")
    with col2:
        target_group = st.text_input("ุงูุฌูููุฑ ุงููุณุชูุฏู", placeholder="ูุซูุงู: ุฃุตุญุงุจ ุงูุณูุจุฑ ูุงุฑูุช ูุงููุญูุงุช")
        competitor_flaw = st.text_area("ููุงุท ุถุนู ุงูููุงูุณูู", placeholder="ูุซูุงู: ุฃุณุนุงุฑูู ุบุงููุฉ ูุฏุนู ููู ุจุทูุก")

# --- ุงูุชุจููุจ ุงูุซุงูู: ุชูููุฏ ุงููุญุชูู ---
with tab2:
    st.subheader("๐ ุงูุฑุณุงูุฉ ุงูุฅุนูุงููุฉ")
    col3, col4 = st.columns(2)
    with col3:
        advantage = st.text_input("ููุฒุชู ุงูุชูุงูุณูุฉ ุงููุจุฑู", placeholder="ูุซูุงู: ุฏุนู ููู 24 ุณุงุนุฉ ูุฑุจุท ุจุงูููุจุงูู")
    with col4:
        offer = st.text_input("ุงูุนุฑุถ ุงูุฎุงุต ุงูุญุงูู", placeholder="ูุซูุงู: ุฎุตู 25% ูุชุฑููุจ ูุฌุงูู")

# --- ุงูุชุจููุจ ุงูุซุงูุซ: ุงูุชุตููู ุงููุฑุฆู ---
with tab3:
    st.subheader("๐จ ุฃูุตุงู ุงูุตูุฑ (AI Prompts)")
    visual_style = st.selectbox("ุงุฎุชุฑ ููุท ุงูุตูุฑ ููุฅุนูุงู", ["ูุงูุนู ุฌุฏุงู (Photorealistic)", "ุฑุณูู ูุชุญุฑูุฉ (3D Render)", "ุชุตููู ูุณุทุญ (Flat Design)", "ุณูููุงุฆู (Cinematic)"])
    st.info("ุงุณุชุฎุฏู ุงูุฃูุตุงู ุงูุชู ุณุชุธูุฑ ููุง ูู ุจุฑุงูุฌ ูุซู Midjourney ุฃู DALL-E.")

# --- ุงูุชุจููุจ ุงูุฑุงุจุน: ุฌุฏูู ุงูู 30 ูููุงู ---
with tab4:
    st.subheader("๐๏ธ ุฎุทุฉ ุงููุญุชูู ุงูุดูุฑู")
    generate_calendar = st.checkbox("ุฃุฑูุฏ ุชูููุฏ ุฌุฏูู ููุดูุฑุงุช ูุดูุฑ ูุงูู (30 ููู)")

# --- ุฒุฑ ุงูุชูููุฐ ุงูููุงุฆู ---
st.divider()
if st.button("ุชูููุฏ ุงูููุธููุฉ ุงูุชุณููููุฉ ุงููุงููุฉ โจ"):
    if not prod_name or not pain_point:
        st.error("โ๏ธ ูุฑุฌู ุชุนุจุฆุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ูู ุชุจููุจ (ุชุญููู ุงูุณูู) ุฃููุงู.")
    else:
        # 1. ุจูุงุก ุงูุชูุฑูุฑ ุงููุตู
        report = f"""
        *๐ ุฎุทุฉ ุชุณููู ุงุญุชุฑุงููุฉ ูู {prod_name}*
        ----------------------------------
        ๐ฏ *ุงูุฌูููุฑ ุงููุณุชูุฏู:* {target_group}
        โ *ุงููุดููุฉ ุงูุชู ูุญููุง:* {pain_point}
        โ๏ธ *ููุงุท ุชููููุง ุนูู ุงูููุงูุณูู:* {advantage}
        ----------------------------------
        ๐ข *ุงูุฅุนูุงู ุงูููุชุฑุญ (ุตูุบุฉ AIDA):*
        ูู ุชุนุจุช ูู {pain_point}ุ ๐ซ 
        ุงูููุงูุณูู ููุฏููู ุญูููุงู ูุนูุฏุฉุ ููู ูุน **{prod_name}** ุงูุฃูุฑ ูุฎุชูู ุชูุงูุงู! 
        ูุญู ูุถูู ูู {advantage}.
        ๐ฅ *ุงูุนุฑุถ:* {offer}
        ----------------------------------
        ๐ผ๏ธ *ูุตู ุชุตููู ุงูู AI:*
        Digital art of {target_group} using {prod_name}, solving {pain_point}, in a {visual_style} style, high quality, 8k resolution.
        """

        # 2. ุชูููุฏ ุงูุฌุฏูู ุงูุฒููู ุฅุฐุง ุชู ุงุฎุชูุงุฑู
        calendar_text = ""
        if generate_calendar:
            content_types = [
                "๐ก ููุดูุฑ ุชุนูููู: ููู ุชุชุบูุจ ุนูู {pain}ุ",
                "๐ฏ ููุดูุฑ ุจูุนู: ููุงุฐุง {prod} ูู ุงุฎุชูุงุฑ {target} ุงูุฃููุ",
                "โ ููุดูุฑ ุชูุงุนูู: ูุง ูู ุฃูุซุฑ ุดูุก ูุฒุนุฌู ูู ุฅุฏุงุฑุฉ ูุดุฑูุนูุ",
                "๐ ูุตุฉ ูุฌุงุญ: ููู ููุฑ {prod} ุงูููุช ูุนููุงุฆูุงุ",
                "๐ ุนุฑุถ ุฎุงุต: ูุง ุชููุช {offer} ุงููุชุงุญ ุงูุขู!"
            ]
            calendar_text = "\n\n๐ *ุฌุฏูู ุงููุญุชูู (ุฃูุซูุฉ ููุฃูุงู ุงูุฃููู):*\n"
            for i in range(1, 31):
                raw_idea = random.choice(content_types)
                idea = raw_idea.format(pain=pain_point, prod=prod_name, offer=offer, target=target_group)
                calendar_text += f"ุงูููู {i}: {idea}\n"

        # ุนุฑุถ ุงููุชุงุฆุฌ ูู ุงููููุน
        st.success("โ ุชู ุชูููุฏ ุงูููุธููุฉ ุจูุฌุงุญ!")
        st.markdown(report)
        if generate_calendar:
            with st.expander("ูุดุงูุฏุฉ ุฌุฏูู ุงูู 30 ูููุงู ุจุงููุงูู"):
                st.text(calendar_text)
        
        # ุญูุธ ูู ุงูุฐุงูุฑุฉ ููุฅุฑุณุงู
        st.session_state['final_full_report'] = report + calendar_text

# --- ุฒุฑ ุฅุฑุณุงู ูุงุชุณุงุจ ---
if 'final_full_report' in st.session_state:
    st.divider()
    if st.button("๐จ ุฅุฑุณุงู ูู ูุง ุณุจู ููุนููู ุนุจุฑ ูุงุชุณุงุจ"):
        if client_phone:
            try:
                # ุฅุฑุณุงู ูุงุชุณุงุจ (ูุนูู ูู ุงูุจูุฆุฉ ุงููุญููุฉ)
                kit.sendwhatmsg_instantly(client_phone, st.session_state['final_full_report'], wait_time=15)
                st.toast("ุฌุงุฑู ูุญุงููุฉ ูุชุญ ูุงุชุณุงุจ ููุจ...")
            except:
                st.error("ูุดู ุงูุฅุฑุณุงู ุงูุชููุงุฆู. ุชุฃูุฏ ูู ุชุดุบูู ุงูุจุฑูุงูุฌ ุนูู ุฌูุงุฒู (Local) ูููุณ ููุท ูู ุงูุณุญุงุจ.")
        else:
            st.warning("ูุฑุฌู ุฅุฏุฎุงู ุฑูู ูุงุชู ุงูุนููู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ.")
